----1 sys에서 사용자 만들고 권한주기----
CREATE USER medipaw IDENTIFIED BY 1111; 
GRANT RESOURCE, CREATE SESSION TO medipaw;
GRANT CREATE VIEW TO medipaw;
GRANT CREATE TRIGGER TO medipaw;

--- medipaw에서 테이블/뷰/트리거 생성 ---
-- member staff 먼저 생성 후 animalhosp_main csv import하기
-- table create

-- 각자 완성된 쿼리문만 넣기
-- 순서 맞춰서 잘 넣어주세염






-- fk 지정 쿼리문 붙어있어서 맨 마지막에 create하기
CREATE TABLE SILJONG (
SJNO   NUMBER   CONSTRAINT PK_SILJONG PRIMARY KEY,
SJSTATE   VARCHAR2(50)   NOT NULL,
SJTITLE   VARCHAR2(200)   NOT NULL,
SJCONTENT   VARCHAR2(1000)   NOT NULL,
ID   VARCHAR2(50)   NOT NULL,
SJREGDATE   DATE   NOT NULL,
SJHIT   NUMBER   DEFAULT 0,
SJREPLYCNT   NUMBER   DEFAULT 0,
CONSTRAINT FK_SILJONG_MEMBER FOREIGN KEY (ID) REFERENCES MEMBER(ID) ON DELETE CASCADE
);

CREATE TABLE SJ_REPLY (
SJRNO   NUMBER   CONSTRAINT PK_SJ_REPLY PRIMARY KEY,
SJREPLY   VARCHAR(1000)   NOT NULL,
ID   VARCHAR(50)   NOT NULL,
SJRREGDATE   DATE   NOT NULL,
SJNO   NUMBER   NOT NULL,
CONSTRAINT FK_SJ_REPLY_SILJONG FOREIGN KEY (SJNO) REFERENCES SILJONG(SJNO) ON DELETE CASCADE,
CONSTRAINT FK_SJ_REPLY_MEMBER FOREIGN KEY (ID) REFERENCES MEMBER(ID) ON DELETE CASCADE
);

CREATE TABLE SJ_ATTACH (
UUID   VARCHAR2(100)   CONSTRAINT PK_SJ_ATTACH PRIMARY KEY,
UPFOLDER   VARCHAR2(200)   NOT NULL,
FILENAME   VARCHAR2(100)   NOT NULL,
SJNO   NUMBER   NOT NULL,
CONSTRAINT FK_SJ_ATTACH_SILJONG FOREIGN KEY (SJNO) REFERENCES SILJONG(SJNO) ON DELETE CASCADE
);

CREATE TABLE RESERV (
RVNO   NUMBER   CONSTRAINT PK_RESERV PRIMARY KEY,
RVDATE   VARCHAR2(50)   NOT NULL,
RVTIME   VARCHAR2(50)   NOT NULL,
PETNAME   VARCHAR2(50)   NOT NULL,
PETSPECIES   VARCHAR2(50)   NOT NULL,
PETGENDER   VARCHAR2(50)   NOT NULL,
PETNOTE   VARCHAR2(1000)   NULL,
ANIMALHOSP_NO   NUMBER   NOT NULL,
ID   VARCHAR2(50)   NOT NULL,
CONSTRAINT FK_RESERV_ANIMALHOSP FOREIGN KEY (ANIMALHOSP_NO) REFERENCES ANIMALHOSP_MAIN(ANIMALHOSP_NO),
CONSTRAINT FK_RESERV_MEMBER FOREIGN KEY (ID) REFERENCES MEMBER(ID) ON DELETE CASCADE
);

CREATE TABLE TREAT (
TNO   NUMBER   CONSTRAINT PK_TREAT PRIMARY KEY,
TRDATE   VARCHAR2(50)   NOT NULL,
TRTIME   VARCHAR2(50)   NOT NULL,
TRNOTE   VARCHAR2(1000)   NOT NULL,
ANIMALHOSP_NO   NUMBER   NOT NULL,
RVNO   NUMBER   ,
DELCHECK CHAR(1) DEFAULT 0,
ID   VARCHAR2(50)   NOT NULL,
CONSTRAINT FK_TREAT_ANIMALHOSP FOREIGN KEY (ANIMALHOSP_NO) REFERENCES ANIMALHOSP_MAIN(ANIMALHOSP_NO),
CONSTRAINT FK_TREAT_RESERV FOREIGN KEY (RVNO) REFERENCES RESERV(RVNO) ON DELETE SET NULL,
CONSTRAINT FK_TREAT_MEMBER FOREIGN KEY (ID) REFERENCES MEMBER(ID) ON DELETE CASCADE
);

CREATE TABLE MARK (
MNO   NUMBER   CONSTRAINT PK_MARK PRIMARY KEY,
ID   VARCHAR2(50)   NOT NULL,
ANIMALHOSP_NO   NUMBER   NOT NULL,
CONSTRAINT FK_MARK_ANIMALHOSP FOREIGN KEY (ANIMALHOSP_NO) REFERENCES ANIMALHOSP_MAIN(ANIMALHOSP_NO) ON DELETE CASCADE,
CONSTRAINT FK_MARK_MEMBER FOREIGN KEY (ID) REFERENCES MEMBER(ID) ON DELETE CASCADE
);




-- view create
CREATE OR REPLACE VIEW view_reserv_adm AS 
SELECT A.ANIMALHOSP_NAME AS HOSNAME,
       A.HSOP_ROADNAME_ADDRESS AS HOSADDRESS,
       A.HSOP_PHONENUM AS HOSPHONE,
       M.NAME AS NAME,
       R.RVDATE AS RVDATE,
       R.RVTIME AS RVTIME,
       R.RVNO AS RVNO
  FROM ANIMALHOSP_MAIN A
       INNER JOIN RESERV R ON A.ANIMALHOSP_NO = R.ANIMALHOSP_NO
       INNER JOIN MEMBER M ON R.ID = M.ID
  ORDER BY RVDATE DESC, RVTIME DESC;

CREATE OR REPLACE VIEW view_treat_adm AS
SELECT A.ANIMALHOSP_NAME AS animalhosp_name,
       A.HSOP_ROADNAME_ADDRESS AS hsop_roadname_address,
       A.HSOP_PHONENUM AS hsop_phonenum,
       M.NAME AS NAME,
       T.TRDATE AS TRDATE,
       T.TRTIME AS TRTIME,
       T.RVNO AS RVNO,
       T.TNO AS TNO
  FROM ANIMALHOSP_MAIN A
       INNER JOIN TREAT T ON A.ANIMALHOSP_NO = T.ANIMALHOSP_NO
       INNER JOIN MEMBER M ON T.ID = M.ID
  ORDER BY TRDATE DESC, TRTIME DESC;


-- trigger create


-- index create
CREATE INDEX idx_reserv ON reserv(rvno DESC);       
CREATE INDEX idx_sjreply ON SJ_REPLY(sjno DESC, sjrno ASC);




--seq create
CREATE SEQUENCE SILJONG_SEQ NOCACHE;
CREATE SEQUENCE SJ_REPLY_SEQ NOCACHE;
CREATE SEQUENCE MARK_SEQ NOCACHE;
CREATE SEQUENCE RESERV_SEQ NOCACHE;
CREATE SEQUENCE TREAT_SEQ NOCACHE;


