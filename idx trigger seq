CREATE INDEX idx_name_id ON staff (sname, sid);

CREATE OR REPLACE TRIGGER add_staff_auth
AFTER INSERT ON staff
FOR EACH ROW
BEGIN
    INSERT INTO staff_auth (sid, auth) VALUES (:NEW.sid, 'ROLE_STAFF');
END;


CREATE OR REPLACE TRIGGER remove_staff_auth
AFTER DELETE ON staff
FOR EACH ROW
BEGIN
    DELETE FROM staff_auth WHERE sid = :OLD.sid;
END;

CREATE OR REPLACE TRIGGER trigger_review
AFTER INSERT
ON review
FOR EACH ROW
BEGIN
    UPDATE animalhosp_main SET rv_cnt = rv_cnt + 1 WHERE animalhosp_no = :NEW.animalhosp_no;
    UPDATE animalhosp_main SET star_total = star_total + :NEW.star WHERE animalhosp_no = :NEW.animalhosp_no;
END;

CREATE OR REPLACE TRIGGER trigger_review_update
AFTER UPDATE ON review
FOR EACH ROW
BEGIN
    UPDATE animalhosp_main SET star_total = star_total - :OLD.star + :NEW.star WHERE animalhosp_no = :OLD.animalhosp_no;
END;

CREATE OR REPLACE TRIGGER trigger_review_delete
AFTER DELETE ON review
FOR EACH ROW
BEGIN
    UPDATE animalhosp_main SET rv_cnt = rv_cnt - 1, star_total = star_total - :OLD.star WHERE animalhosp_no = :OLD.animalhosp_no;
END;



CREATE SEQUENCE rno_seq
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE SEQUENCE byno_seq
START WITH 1
INCREMENT BY 1
NOCACHE;
